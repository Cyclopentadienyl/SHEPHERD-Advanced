# SHEPHERD-Advanced Directory Structure Blueprint

**Last Updated**: 2026-02-24
**Status**: Canonical Reference

This document defines the official directory layout for the SHEPHERD-Advanced project. All code, configuration, and runtime artifacts should follow this structure.

---

## Top-Level Layout

```
SHEPHERD-Advanced/
├── configs/                # Configuration files (YAML)
├── data/                   # Input data (raw + processed)
├── deployment/             # Deployment manifests (future: Docker, K8s)
├── docs/                   # Documentation
├── logs/                   # Training logs & real-time progress
├── models/                 # All model artifacts (checkpoints, pretrained, production)
├── outputs/                # Training outputs (final metrics, results)
├── reports/                # Evaluation reports & analysis
├── scripts/                # Entry-point scripts (train, evaluate, infer)
├── src/                    # Source code (7-layer architecture)
└── tests/                  # Test suite (unit, integration, e2e)
```

---

## Directory Details

### `configs/` — Configuration Files

Centralized YAML configuration for all runtime modes.

```
configs/
├── default.yaml             # Default training hyperparameters
├── deployment.yaml          # Unified deployment configuration (v3.2)
├── logging.yaml             # Logging configuration
└── ...
```

**Used by**: `scripts/train_model.py`, `src/api/main.py`

---

### `data/` — Input Data

All input datasets. Large files are excluded from version control via `.gitignore`.

```
data/
├── external/                # Large external datasets (git-ignored)
│   ├── README.md            # Download instructions
│   └── .gitignore           # Ignores all data files
└── processed/               # Processed data ready for training
    └── knowledge_graph/     # Knowledge graph artifacts
        ├── node_features.pt
        ├── edge_indices.pt
        ├── metadata.json
        └── VERSION
```

**Used by**: Training pipeline (`scripts/train_model.py`), data processing scripts
**Default path in UI**: `SHEPHERD-Advanced/data/processed`

---

### `logs/` — Training Logs

Runtime training logs and real-time progress files. Written by `MetricsLogger` callback.

```
logs/
├── .gitkeep
├── progress.json            # Real-time batch-level progress (updated every ~5s)
└── train_YYYYMMDD_HHMMSS.json  # Epoch-level metrics history (one per training run)
```

**Used by**: `src/training/callbacks.py` (MetricsLogger), `src/api/services/training_manager.py` (polling)
**Default path**: `logs/`

---

### `models/` — Model Artifacts

All model-related files organized by lifecycle stage.

```
models/
├── checkpoints/             # Training checkpoints (.pt files)
│   ├── .gitkeep
│   ├── last.pt              # Latest checkpoint (auto-saved)
│   ├── model-epoch03-0.1234.pt  # Top-K best checkpoints
│   └── ...
├── experiments/             # Experimental/trial models (manual saves)
│   └── .gitkeep
├── pretrained/              # Pretrained base models (e.g., ClinicalBERT for NLP module)
│   └── README.md
└── production/              # Production-ready models (promoted from checkpoints)
    └── registry.json        # Model registry (tracks promoted models)
```

**Lifecycle**: `checkpoints/` → (evaluate) → `production/` (via promotion)
**Default checkpoint path in UI**: `SHEPHERD-Advanced/models/checkpoints`

| Subdirectory | Purpose | When Populated |
|---|---|---|
| `checkpoints/` | Auto-saved during training (top-K best + last.pt) | Every training run |
| `experiments/` | Manual saves for experimental configurations | User-initiated |
| `pretrained/` | Downloaded pretrained models for fine-tuning | Before first training |
| `production/` | Promoted best models for inference serving | After evaluation |

---

### `outputs/` — Training Outputs

Final training results, exported metrics, and generated artifacts.

```
outputs/
├── .gitkeep
├── training_metrics_YYYYMMDD.csv   # Exported metrics CSV
└── final_results.json              # Final training summary
```

**Used by**: `src/api/services/training_manager.py`, `scripts/train_model.py`
**Default path in UI**: `SHEPHERD-Advanced/outputs`

---

### `reports/` — Evaluation Reports

Evaluation and analysis reports generated by evaluation scripts.

```
reports/
├── .gitkeep
└── eval_report_YYYYMMDD.json   # Evaluation results (MRR, Hits@K, etc.)
```

**Used by**: `scripts/evaluate_model.py`
**Distinct from `outputs/`**: `outputs/` stores raw training artifacts; `reports/` stores structured evaluation analyses.

---

### `scripts/` — Entry-Point Scripts

Standalone scripts that serve as subprocess entry points.

```
scripts/
├── train_model.py           # Training entry point (launched by TrainingManager)
├── evaluate_model.py        # Evaluation entry point
├── test_gnn_inference.py    # GNN inference testing
├── process_knowledge_graph.py  # KG data processing
└── ...
```

---

### `src/` — Source Code (7-Layer Architecture)

```
src/
├── core/          # Layer 0: Types, protocols, config, utilities
├── kg/            # Layer 2: Knowledge graph builder, ontology, data sources
├── data_sources/  # Layer 2: External data connectors (HPO, MONDO, PubMed)
├── retrieval/     # Layer 3: Vector index, subgraph sampler
├── models/        # Layer 4: ShepherdGNN, HeteroGNNLayer, attention backends
├── training/      # Layer 1: Trainer, loss functions, callbacks
├── inference/     # Layer 5: Inference pipeline, path reasoner, explanation
├── reasoning/     # Layer 5: Path reasoning, evidence scoring
├── api/           # Layer 6: FastAPI routes, services, middleware
├── webui/         # Layer 6: Gradio dashboard components
└── config/        # Layer 0: Hyperparameter definitions
```

**Import rules** (enforced by import-linter):
- `webui` → `api` (allowed)
- `webui` → `training` (FORBIDDEN — use subprocess via TrainingManager)
- Higher layers may import lower layers, not vice versa

---

### `tests/` — Test Suite

```
tests/
├── unit/            # Unit tests (fast, no external deps)
├── integration/     # Integration tests (may use filesystem, subprocess)
├── e2e/             # End-to-end tests (full pipeline)
├── conftest.py      # Shared fixtures
└── ...
```

---

## Runtime Directory Creation

The following directories are created automatically at runtime if they don't exist:

| Directory | Created By | When |
|---|---|---|
| `logs/` | `TrainingManager.start_training()` | Training start |
| `models/checkpoints/` | `TrainingManager.start_training()` | Training start |
| `outputs/` | `TrainingManager.start_training()` | Training start |

---

## Git Tracking Strategy

| Directory | Tracked | Strategy |
|---|---|---|
| `configs/` | Yes | All YAML files tracked |
| `data/external/` | Structure only | `.gitignore` excludes data files |
| `data/processed/` | Metadata only | `metadata.json` + `VERSION` tracked |
| `logs/` | Structure only | `.gitkeep` tracked, log files ignored |
| `models/checkpoints/` | Structure only | `.gitkeep` tracked, .pt files ignored |
| `models/production/` | Registry only | `registry.json` tracked |
| `outputs/` | Structure only | `.gitkeep` tracked, artifacts ignored |
| `reports/` | Structure only | `.gitkeep` tracked, report files ignored |

---

## Path Display Convention

In the Gradio UI, all paths are displayed with the `SHEPHERD-Advanced/` prefix for clarity:

| UI Display | Actual Path (relative to project root) |
|---|---|
| `SHEPHERD-Advanced/data/processed` | `data/processed` |
| `SHEPHERD-Advanced/outputs` | `outputs` |
| `SHEPHERD-Advanced/models/checkpoints` | `models/checkpoints` |

The prefix is automatically stripped before passing to the training backend.
